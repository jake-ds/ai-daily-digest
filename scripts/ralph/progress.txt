# Ralph Progress Log
Started: 2026년 2월 21일 토요일 03시 32분 43초 KST

## Codebase Patterns
- SCENARIOS dict is in `web/services/linkedin_service.py` (module-level) - used by both service and API
- `web/api/linkedin.py` has regex validators for scenario parameter (e.g., `^[A-F]$`) - update when adding scenarios
- `detect_scenario()` uses keyword-based heuristics with priority ordering (first match wins)
- Always `python -m py_compile` after editing Python files
- ReferencePost model: `web/models/reference_post.py` - content, author, source_url, analysis fields
- Guidelines examples in markdown use pattern: `### 시나리오 X 예시` followed by code block
- Both LinkedInService and LinkedInAgent need parallel changes for prompt improvements
---

## 2026-02-21 - LQ-003
- Added `_get_reference_examples(scenario)` to both LinkedInService and LinkedInAgent
- DB reference posts (max 2) + guidelines example extraction via regex
- Included as "참고 예시" section in prompts for both simple and agent mode
- Files changed: web/services/linkedin_service.py, web/services/linkedin_agent.py
- **Learnings for future iterations:**
  - ReferencePost has no scenario column - currently gets most recent posts regardless of scenario
  - Guidelines examples use `### 시나리오 X 예시` + code blocks - regex pattern extracts content between ```
  - Changes to prompt building in linkedin_service.py usually need mirror changes in linkedin_agent.py
---

## 2026-02-21 - LQ-002
- Integrated self.guidelines into _build_prompt() with conditional logic
- When guidelines file exists: full guidelines text included as "작성 지침서" section
- When guidelines empty: fallback to existing hardcoded rules (문체, 금지사항, 구조, 길이)
- Prompt structure: 페르소나 → 시나리오 → 기사 정보 → 지침서/규칙 → 출력 형식
- Files changed: web/services/linkedin_service.py
- **Learnings for future iterations:**
  - _build_prompt() uses f-string with conditional sections built as variables
  - self.guidelines loaded from LINKEDIN_GUIDELINES_PATH (data/linkedin_guidelines.md)
  - The hardcoded rules are a minimal fallback; the full guidelines file is much more comprehensive
---

## 2026-02-21 - LQ-001
- Added Scenario F (권위자 관점 + 역설적 인사이트) to SCENARIOS dict with all required fields
- Added Scenario F detection keywords to detect_scenario(): 권위자, expert, 통념, 학습, fomo, 배워야, 역설, misconception, myth, contrary
- Updated regex in web/api/linkedin.py from ^[A-E]$ to ^[A-F]$ (both generate and agent endpoints)
- Updated docstrings to reflect A-F range
- Files changed: web/services/linkedin_service.py, web/api/linkedin.py
- **Learnings for future iterations:**
  - The regex `^[A-E]$` appears in TWO places in linkedin.py (generate_draft and agent_start) - use replace_all
  - detect_scenario() has priority ordering: more specific keywords first, Scenario F keywords last since they're broader
  - SCENARIOS dict fields: name, description, hook_style, structure, closing
---
